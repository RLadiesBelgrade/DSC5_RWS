<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
  <head>
    <title>Responding to analysis and communication: Data science the R way</title>
    <meta charset="utf-8" />
    <meta name="author" content="Jovana, Tijana, Katica &amp; Tatjana" />
    <link href="libs/remark-css/default.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <script src="libs/jquery/jquery.min.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="css\ohsu.css" type="text/css" />
    <link rel="stylesheet" href="css\ohsu-fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Responding to analysis and communication: Data science the R way
## R-Ladies
### Jovana, Tijana, Katica &amp; Tatjana
### November 2019

---


background-image: url(https://upload.wikimedia.org/wikipedia/commons/c/c1/Rlogo.png)
???

Image credit: [Wikimedia Commons](https://commons.wikimedia.org/wiki/File:Rlogo.png)
---


class: center, middle

#How do we do it? &amp;#9728;

###Steps of a typical data science project:
&lt;img src="images/Program_HW.png" width="500px" /&gt;
---
class: inverse, center, middle

#Get Started ðŸ¤«ðŸ˜´
&lt;img src="images/George_Desk.gif" width="600px" /&gt;
---
##Before there was R, there was S! ðŸ¤ 

**R** is a dialect of **S** language that was developed in 1976 by *Rick Becker* and *John Chambers* at the  Bell Laboratories.

*Rick Becker* gave an excellent keynote talk *"Forty Years of S"* at UseR!2016 conference:   
[Rick Becker @ UseR!2016](http://blog.revolutionanalytics.com/2016/07/rick-becker-s-talk.html) where he talked about development of **S** language that gives explanations for many characteristics of **R** as we know it, including "&lt;-" assignment operator.

1993 Bell Labs gave StatSci (later Insightful Corp.) an exclusive license to develop and sell the **S** language. Insightful sold its implementation of the **S** language under the product name **S-PLUS**.

You can read more about the [history of S, R, and S-PLUS](https://www.whoishostingthis.com/resources/s-plus/)
---
## then, R was born ðŸ˜‡ðŸŽ¶
In early nineties at the University of Aucklandn in the Department of Statistics **R** was created by *Ross Ihaka* and *Robert Gentleman*.

They used [GNU General Public License](http://www.gnu.org/licenses/gpl-2.0.html) to make R open source free software. 

**R**oss Ihaka and **R**obert Gentleman. *R: A language for data analysis and graphics.* Journal of Computational and Graphical Statistics, 5(3):299â€“314, 1996

Currently **R** is developed by the **R Development Core Team**, of which *John Chambers* is a member.
---
##Write R Code

To start using **R** you need to:

1) Install [R](https://cran.r-project.org/) [(and RStudio)](https://www.rstudio.com/products/rstudio/download/#download)

2) Launch it and set your working directory: letting R know where to find all of your files.

3) Start writing **R** code!

**Tip**ðŸ’¡:
- When start working on a new R code/R Project in [RStudio IDE](https://support.rstudio.com/hc/en-us/sections/200107586-Using-the-RStudio-IDE) use 
***File -&gt; New Project*** 
This way your working directory would be set up when you start a new project and it will save all your files in it. Next time you open your project it would set project's directory as a working directory... It would help you with so much [more](https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects). 
---
class: center, middle

##[RStudio IDE Cheatsheet](https://www.rstudio.com/wp-content/uploads/2016/01/rstudio-IDE-cheatsheet.pdf)

&lt;img src="images/RStudio.png" width="500px" /&gt;

***Top Left:*** Code Editor;
--

***Bottom Left:*** R Console;
--

***Top Right:*** Environment
--

***Bottom Right:*** Plots and Files
---
##Dataset

**gapminder** dataset available from **gapminder** package.
For each of 142 countries, the package provides values for life expectancy, GDP per capita, and population, every five years, from 1952 to 2007.

&lt;!--htd="htmlwidget-61c4ae97191590742e71" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-61c4ae97191590742e71">{"x":{"filter":"none","data":[["1","2","3","4"],["Afghanistan","Afghanistan","Afghanistan","Afghanistan"],["Asia","Asia","Asia","Asia"],[1952,1957,1962,1967],[28.801,30.332,31.997,34.02],[8425333,9240934,10267083,11537966],[779.4453145,820.8530296,853.10071,836.1971382]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>country<\/th>\n      <th>continent<\/th>\n      <th>year<\/th>\n      <th>lifeExp<\/th>\n      <th>pop<\/th>\n      <th>gdpPercap<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script><!--/h thet there are 6 columns, each of which we call a **variable**. 

---
class: inverse, center, middle
  
#How do we do it in R? ðŸ¤“
---
##Before Tidyverse R, there is Base R!
When you download and install **R** for the first time, you are installing **the Base R** software. **Base R** contains most of the functions youâ€™ll use on a daily basis: `mean()`, `subset()`...

To learn about **R**'s basic operations, data structures and base functions you could look at one of the R-Ladies Manchester's handouts: [Introduction to base R](https://tanjakec.github.io/blog/introduction-to-r/).

If you want to access data and code written by other people, youâ€™ll need to install it as a **package**. An **R package** is a bundle of functions (code), data, documentation, vignettes (examples), stored in one neat place.

"In **R**, the fundamental unit of shareable code is the package." [Hadley Wickham](http://r-pkgs.had.co.nz/intro.html)  
---
##The verse! ðŸ˜‡ðŸŽ¶
An opinionated collection of **R packages** for data science.

[`install.packages("tidyverse")`](https://www.tidyverse.org/)

[`library(tidyverse)`](https://www.tidyverse.org/packages/)

- Have you tried learning data science by reading books? 

ðŸ“–ðŸ“˜ [**R for Data Science**](http://r4ds.had.co.nz/) by Garrett Grolemund &amp; Hadley Wickham

- Have you tried learning data science by posting your questions and discussing it with other people within the R community?

ðŸ‘¥ðŸ’»ðŸ“ŠðŸ“ˆðŸ—£ [**RStudio Community**](https://community.rstudio.com/)
---
##The &lt;span style="color:blue"&gt;`dplyr`&lt;/span&gt; Package: 
provides a â€œgrammarâ€ (the verbs) for data manipulation and for operating on data frames. The **key opertor and the esential verbs** are :

- &lt;span style="color:blue"&gt;`%&gt;%`&lt;/span&gt;: **the â€œpipeâ€ operator** used to connect multiple verb actions together into a pipeline.

- &lt;span style="color:blue"&gt;`select()`&lt;/span&gt;: return a subset of the columns of a data frame.

- &lt;span style="color:blue"&gt;`mutate()`&lt;/span&gt;: add new variables/columns or transform existing variables.

- &lt;span style="color:blue"&gt;`filter()`&lt;/span&gt;: extract a subset of rows from a data frame based on logical conditions.

- &lt;span style="color:blue"&gt;`arrange()`&lt;/span&gt;: reorder rows of a data frame according to single or multiple variables.

- &lt;span style="color:blue"&gt;`summarise()`&lt;/span&gt; / &lt;span style="color:blue"&gt;`summarize()`&lt;/span&gt;: reduces each group to a single row by calculating aggregate measures. 
---
##Gapminder Data

Excerpt of the Gapminder data on life expectancy, GDP per capita, and population by country.

The main data frame gapminder has **1704 rows** and **6 variables**:
- **country**: factor with 142 levels
- **continent**: factor with 5 levels
- **year**: ranges from 1952 to 2007 in increments of 5 years
- **lifeExp**: life expectancy at birth, in years
- **pop**: population
- **gdpPercap**: GDP per capita


```r
gapminder::gapminder[1:3,]
```

```
## # A tibble: 3 x 6
##   country     continent  year lifeExp      pop gdpPercap
##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
## 1 Afghanistan Asia       1952    28.8  8425333      779.
## 2 Afghanistan Asia       1957    30.3  9240934      821.
## 3 Afghanistan Asia       1962    32.0 10267083      853.
```
---
class: center 

##Setting up Working Environment ðŸ’¡

.pill-left[
Install necessary packages you will be working with!


```r
install.packages("dplyr", repos = "http://cran.us.r-project.org")
install.packages("ggplot2", repos = "http://cran.us.r-project.org")
install.packages("gapminder", repos = "http://cran.us.r-project.org")
```
]

--
Now we're ready to start practicing Elain's Dance!!! ðŸ˜ƒðŸŽµðŸŽ¶

&lt;img src="images/ElainDanceI.png" width="300px" /&gt;
---
## 1st look at the data: &lt;span style="color:blue"&gt;`dim()`&lt;/span&gt; &amp; &lt;span style="color:blue"&gt;`head()`&lt;/span&gt;


```r
library(gapminder)
dim(gapminder)
```

```
## [1] 1704    6
```

```r
head(gapminder, n=10)
```

```
## # A tibble: 10 x 6
##    country     continent  year lifeExp      pop gdpPercap
##    &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
##  1 Afghanistan Asia       1952    28.8  8425333      779.
##  2 Afghanistan Asia       1957    30.3  9240934      821.
##  3 Afghanistan Asia       1962    32.0 10267083      853.
##  4 Afghanistan Asia       1967    34.0 11537966      836.
##  5 Afghanistan Asia       1972    36.1 13079460      740.
##  6 Afghanistan Asia       1977    38.4 14880372      786.
##  7 Afghanistan Asia       1982    39.9 12881816      978.
##  8 Afghanistan Asia       1987    40.8 13867957      852.
##  9 Afghanistan Asia       1992    41.7 16317921      649.
## 10 Afghanistan Asia       1997    41.8 22227415      635.
```
---
##Examine the structure of the data: &lt;span style="color:blue"&gt;`str()`&lt;/span&gt;

```r
str(gapminder) 
```

```
## Classes 'tbl_df', 'tbl' and 'data.frame':	1704 obs. of  6 variables:
##  $ country  : Factor w/ 142 levels "Afghanistan",..: 1 1 1 1 1 1 1 1 1 1 ...
##  $ continent: Factor w/ 5 levels "Africa","Americas",..: 3 3 3 3 3 3 3 3 3 3 ...
##  $ year     : int  1952 1957 1962 1967 1972 1977 1982 1987 1992 1997 ...
##  $ lifeExp  : num  28.8 30.3 32 34 36.1 ...
##  $ pop      : int  8425333 9240934 10267083 11537966 13079460 14880372 12881816 13867957 16317921 22227415 ...
##  $ gdpPercap: num  779 821 853 836 740 ...
```

The **output could look messy** and it might not fit the screen when dealing with a big data set that has lots of variables! ðŸ¤ª
---
##Do it in a tidy way: &lt;span style="color:blue"&gt;`glimpse()`&lt;/span&gt;


```r
suppressPackageStartupMessages(library(dplyr))
glimpse(gapminder) 
```

```
## Observations: 1,704
## Variables: 6
## $ country   &lt;fct&gt; Afghanistan, Afghanistan, Afghanistan, Afghanistan, ...
## $ continent &lt;fct&gt; Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia, Asia...
## $ year      &lt;int&gt; 1952, 1957, 1962, 1967, 1972, 1977, 1982, 1987, 1992...
## $ lifeExp   &lt;dbl&gt; 28.801, 30.332, 31.997, 34.020, 36.088, 38.438, 39.8...
## $ pop       &lt;int&gt; 8425333, 9240934, 10267083, 11537966, 13079460, 1488...
## $ gdpPercap &lt;dbl&gt; 779.4453, 820.8530, 853.1007, 836.1971, 739.9811, 78...
```
---
##The pipeline operater: &lt;span style="color:blue"&gt;`%&gt;%`&lt;/span&gt;
&lt;pre&gt;
**Left Hand Side (LHS)**   &lt;span style="color:blue"&gt;`%&gt;%`&lt;/span&gt;    **Right Hand Side (RHS)**
&lt;/pre&gt;
&lt;pre&gt;
&lt;span style="color:blue"&gt;x %&gt;% f(..., y)&lt;/span&gt; 

&lt;span style="color:blue"&gt;    f(x,y)&lt;/span&gt;
&lt;/pre&gt;

The "pipe" passes the **result** of the **LHS** as the 1st operator argument of the **function** on the **RHS**

&lt;pre&gt;
&lt;span style="color:blue"&gt;3 %&gt;% sum(4)&lt;/span&gt;      &lt;==&gt;      &lt;span style="color:blue"&gt;  sum(3, 4)&lt;/span&gt;
&lt;/pre&gt;

&lt;span style="color:blue"&gt;`%&gt;%`&lt;/span&gt; is very practical for chaining together multiple &lt;span style="color:blue"&gt;`dplyr`&lt;/span&gt; functions in a sequence of operations.
---
##pick variables by their names: &lt;span style="color:blue"&gt;`select()`&lt;/span&gt;,
&lt;img src="images/select().png" width="450px" /&gt;

- &lt;span style="color:blue"&gt;`starts_with("X")`&lt;/span&gt; every name that starts with "X".

- &lt;span style="color:blue"&gt;`ends_with("X")`&lt;/span&gt; every name that ends with "X".

- &lt;span style="color:blue"&gt;`contains("X")`&lt;/span&gt; every name that contains "X".

- &lt;span style="color:blue"&gt;`matches("X")`&lt;/span&gt; every name that matches "X", where "X" can be a regular expression.

- &lt;span style="color:blue"&gt;`num_range("x", 1:5)`&lt;/span&gt;  the variables named x01, x02, x03, x04, x05.

- &lt;span style="color:blue"&gt;`one_of(x)`&lt;/span&gt; =&gt; every name that appears in x, which should be a character vector.
---
##Select your variables
1) that ends with letter `p`

2) starts with letter `co`. Try to do this selection using base R.  
---
##Solutions:

```r
gm_pop_gdp &lt;- select(gapminder, ends_with("p"))
head(gm_pop_gdp, n = 1)
```

```
## # A tibble: 1 x 3
##   lifeExp     pop gdpPercap
##     &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;
## 1    28.8 8425333      779.
```

```r
gm_cc &lt;- select(gapminder, starts_with("co"))
head(gm_cc, n = 1)
```

```
## # A tibble: 1 x 2
##   country     continent
##   &lt;fct&gt;       &lt;fct&gt;    
## 1 Afghanistan Asia
```
of course all of this could be done using **base R** like for example:

```r
gm_cc &lt;- gapminder[c("country", "continent")]
```
but it's less intuitive and often requires more typing. 
---
##Create new variables of existing variables: &lt;span style="color:blue"&gt;`mutate()`&lt;/span&gt;
&lt;img src="images/mutate().png" width="400px" /&gt;

It would allow you to add to the data frame `df` a new column, `z`, which is the multiplication of the columns `x` and `y`: `mutate(df, z = x * y)`.
If we would like to observe `lifeExp` measured in months we could create a new column `lifeExp_month`: 

```r
gapminder2 &lt;- mutate(gapminder, LifeExp_month = lifeExp * 12) 
head(gapminder2, n = 2)
```

```
## # A tibble: 2 x 7
##   country     continent  year lifeExp     pop gdpPercap LifeExp_month
##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 Afghanistan Asia       1952    28.8 8425333      779.          346.
## 2 Afghanistan Asia       1957    30.3 9240934      821.          364.
```
---
##Pick observations by their values: &lt;span style="color:blue"&gt;`filter()`&lt;/span&gt;
&lt;img src="images/filter().png" width="450px" /&gt;

There is a set of logical operators in **R** that you can use inside `filter()`:

- `x &lt; y`: `TRUE` if `x` is less than `y`
- `x &lt;= y`: `TRUE` if `x` is less than or equal to `y`
- `x == y`: `TRUE` if `x` equals `y`
- `x != y`: `TRUE` if `x` does not equal `y`
- `x &gt;= y`: `TRUE` if `x` is greater than or equal to `y`
- `x &gt; y`: `TRUE` if `x` is greater than `y`
- `x %in% c(a, b, c)`: `TRUE` if `x` is in the vector `c(a, b, c)`
- `is.na(x)`:  Is `NA`
- `!is.na(x)`: Is not `NA`
---
##Filter your data:

Use `gapminder2` `df` to filter:

1) only Europian countries and save it as `gapmEU`

2) only Europian countries from 2000 onward and save it as `gapmEU21c`

3) rows where the life expectancy is greater than 80

Don't forget to **use `==` instead of `=`**! and
Don't forget the quotes ** `""` **
---
##Solutions:

```r
gapmEU &lt;- filter(gapminder2, continent == "Europe") 
head(gapmEU, 2)
```

```
## # A tibble: 2 x 7
##   country continent  year lifeExp     pop gdpPercap LifeExp_month
##   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 Albania Europe     1952    55.2 1282697     1601.          663.
## 2 Albania Europe     1957    59.3 1476505     1942.          711.
```

```r
gapmEU21c &lt;- filter(gapminder2, continent == "Europe" &amp; year &gt;= 2000)
head(gapmEU21c, 2)
```

```
## # A tibble: 2 x 7
##   country continent  year lifeExp     pop gdpPercap LifeExp_month
##   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 Albania Europe     2002    75.7 3508512     4604.          908.
## 2 Albania Europe     2007    76.4 3600523     5937.          917.
```

```r
filter(gapminder2, lifeExp &gt; 80)
```
---
##Reorder the rows: &lt;span style="color:blue"&gt;`arrange()`&lt;/span&gt;
is used to reorder rows of a **d**ata **f**rame (df) according to one of the variables/columns.

&lt;img src="images/arrange().png" width="300px" /&gt;

- If you pass `arrange()` a character variable, **R** will rearrange the rows in alphabetical order according to values of the variable. 

- If you pass a factor variable, **R** will rearrange the rows according to the order of the levels in your factor (running `levels()` on the variable reveals this order).
---
##Arranging your data
1) Arrange countries in `gapmEU21c` `df` by life expectancy in ascending and descending order.

2) Using `gapminder df`
  - Find the records with the smallest population
  
  - Find the records with the largest life expectancy.
---
##Solution 1):

```r
gapmEU21c_h2l &lt;- arrange(gapmEU21c, lifeExp)
head(gapmEU21c_h2l, 2)
```

```
## # A tibble: 2 x 7
##   country continent  year lifeExp      pop gdpPercap LifeExp_month
##   &lt;fct&gt;   &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 Turkey  Europe     2002    70.8 67308928     6508.          850.
## 2 Romania Europe     2002    71.3 22404337     7885.          856.
```

```r
*gapmEU21c_l2h &lt;- arrange(gapmEU21c, desc(lifeExp))
head(gapmEU21c_l2h, 2)
```

```
## # A tibble: 2 x 7
##   country     continent  year lifeExp     pop gdpPercap LifeExp_month
##   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;         &lt;dbl&gt;
## 1 Iceland     Europe     2007    81.8  301931    36181.          981.
## 2 Switzerland Europe     2007    81.7 7554661    37506.          980.
```
---
##Solution 2):

```r
arrange(gapminder, pop)
```

```
## # A tibble: 1,704 x 6
##    country               continent  year lifeExp   pop gdpPercap
##    &lt;fct&gt;                 &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt; &lt;int&gt;     &lt;dbl&gt;
##  1 Sao Tome and Principe Africa     1952    46.5 60011      880.
##  2 Sao Tome and Principe Africa     1957    48.9 61325      861.
##  3 Djibouti              Africa     1952    34.8 63149     2670.
##  4 Sao Tome and Principe Africa     1962    51.9 65345     1072.
##  5 Sao Tome and Principe Africa     1967    54.4 70787     1385.
##  6 Djibouti              Africa     1957    37.3 71851     2865.
##  7 Sao Tome and Principe Africa     1972    56.5 76595     1533.
##  8 Sao Tome and Principe Africa     1977    58.6 86796     1738.
##  9 Djibouti              Africa     1962    39.7 89898     3021.
## 10 Sao Tome and Principe Africa     1982    60.4 98593     1890.
## # ... with 1,694 more rows
```
---

```r
arrange(gapminder, desc(lifeExp))
```

```
## # A tibble: 1,704 x 6
##    country          continent  year lifeExp       pop gdpPercap
##    &lt;fct&gt;            &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
##  1 Japan            Asia       2007    82.6 127467972    31656.
##  2 Hong Kong, China Asia       2007    82.2   6980412    39725.
##  3 Japan            Asia       2002    82   127065841    28605.
##  4 Iceland          Europe     2007    81.8    301931    36181.
##  5 Switzerland      Europe     2007    81.7   7554661    37506.
##  6 Hong Kong, China Asia       2002    81.5   6762476    30209.
##  7 Australia        Oceania    2007    81.2  20434176    34435.
##  8 Spain            Europe     2007    80.9  40448191    28821.
##  9 Sweden           Europe     2007    80.9   9031088    33860.
## 10 Israel           Asia       2007    80.7   6426679    25523.
## # ... with 1,694 more rows
```
---
##Collapse many values down to a single summary: &lt;span style="color:blue"&gt;`summarise()`&lt;/span&gt;
&lt;img src="images/summarise().png" width="450px" /&gt;

- uses the same syntax as `mutate()`, but the resulting dataset consists of a single row instead of an entire new column in the case of `mutate()`. 

- builds a new dataset that contains only the summarising statistics.

Use `summarise()`:

1) to print out a summary of gapminder containing two variables: max_lifeExp and max_gdpPercap.

2) to print out a summary of gapminder containing two variables: mean_lifeExp and mean_gdpPercap.
---
##Solution: Summarise your data


```r
summarise(gapminder, max_lifeExp = max(lifeExp), max_gdpPercap = max(gdpPercap))
```

```
## # A tibble: 1 x 2
##   max_lifeExp max_gdpPercap
##         &lt;dbl&gt;         &lt;dbl&gt;
## 1        82.6       113523.
```


```r
summarise(gapminder, mean_lifeExp = mean(lifeExp), mean_gdpPercap = mean(gdpPercap))
```

```
## # A tibble: 1 x 2
##   mean_lifeExp mean_gdpPercap
##          &lt;dbl&gt;          &lt;dbl&gt;
## 1         59.5          7215.
```
---
class: inverse, center, middle

## Let's `%&gt;%` all up!

Confer with your neighbours.

What relationship do you expect to see between population size
(`pop`) and life expectancy (`lifeExp`)?
---

&lt;img src="images/pipe_short_cut.png" width="750px" style="display: block; margin: auto;" /&gt;
---
**Do you know what this code does?**

```r
gapminder_pipe &lt;- gapminder %&gt;%
  filter(continent == "Europe" &amp; year ==  2007) %&gt;%
  mutate(pop_e6 = pop / 1000000)
plot(gapminder_pipe$pop_e6, gapminder_pipe$lifeExp, cex = 0.5, col = "red")
```

&lt;img src="Cosmo.jpg" width="250px" style="display: block; margin: auto;" /&gt;
---
&lt;img src="DSRWay_files/figure-html/unnamed-chunk-30-1.png" style="display: block; margin: auto;" /&gt;
---
class: inverse, center, middle

##We have learnt all of Elain's moves!!! ðŸ˜ƒðŸŽµðŸŽ¶

&lt;img src="images/ElainDanceII.png" width="300px" /&gt;
---
class: inverse, center, middle

## Can we make it look better? ðŸ˜
---
class: inverse, center, middle

#"The simple graph has brought more information to the data analystâ€™s mind than any other device."
John Tukey
---
## grammar of graphics
Enables you to specify building blocks of a plot and to combine them to create graphical display you want. There are 8 building blocks:

- data

- aesthetic mapping

- geometric object

- statistical transformations

- scales

- coordinate system

- position adjustments

- faceting
---
##&lt;span style="color:blue"&gt;ggplot()&lt;/span&gt;
1. "Initialise" a plot with `ggplot()`
2. Add layers with `geom_` functions


```r
library(ggplot2)
ggplot(gapminder_pipe, aes(x = pop_e6, y = lifeExp)) +
  geom_point(col ="red")
```

&lt;img src="DSRWay_files/figure-html/unnamed-chunk-32-1.png" style="display: block; margin: auto;" /&gt;
**Tip**: You can use the following code template to make graphs with **ggplot2**:


```r
ggplot(data = &lt;DATA&gt;, (mapping = aes(&lt;MAPPINGS&gt;)) +
  &lt;GEOM_FUNCTION&gt;()
```
---
#&lt;span style="color:blue"&gt;ggplot()&lt;/span&gt; gallery
Run the following code to see what graphs it's going to produce.


```r
ggplot(data = gapminder, mapping = aes(x = lifeExp), binwidth = 10) +
  geom_histogram()
#
ggplot(data = gapminder, mapping = aes(x = lifeExp)) +
  geom_density()
#
ggplot(data = gapminder, mapping = aes(x = continent, color = continent)) +
  geom_bar()
#
ggplot(data = gapminder, mapping = aes(x = continent, fill = continent)) +
  geom_bar()
```
---
##Confer with your neighbours:

**Does the life expectancy depend upon the population size?**
`$$\hat{y}=\hat{\beta_0} + \hat{\beta_1} x + e$$`
Run this code in your console to fit the model `pop` vs `lifeExp`.

Pay attention to spelling, capitalization, and
parentheses!

```r
m1 &lt;- lm(gapminder_pipe$lifeExp ~ gapminder_pipe$pop_e6)
summary(m1)
```
---
**Can you answer the question usig the output of the fitted model?**

```r
m1 &lt;- lm(gapminder_pipe$lifeExp ~ gapminder_pipe$pop_e6)
summary(m1)
```

```
## 
## Call:
## lm(formula = gapminder_pipe$lifeExp ~ gapminder_pipe$pop_e6)
## 
## Residuals:
##    Min     1Q Median     3Q    Max 
## -6.324 -2.562  1.007  2.245  4.277 
## 
## Coefficients:
##                        Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)           77.477421   0.721723 107.351   &lt;2e-16 ***
## gapminder_pipe$pop_e6  0.008762   0.023779   0.368    0.715    
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 3.025 on 28 degrees of freedom
## Multiple R-squared:  0.004826,	Adjusted R-squared:  -0.03072 
## F-statistic: 0.1358 on 1 and 28 DF,  p-value: 0.7153
```
---
## Your turn!

Use gapminder data.

**Does the life expectancy depend upon the GDP per capita?**

1) Have a glance at the data. (tip: `sample_n(df, n)`)

2) Produce a scattep plot: what does it tell you?

3) Fit a regression model: is there a relationship? How strong is it?
Is the relationship linear? What conclusion(s) can you draw?

4) What are the other questions you could ask; could you provide the answers to them?
---
## Possible Solution: code Q1; sample

```r
sample_n(gapminder, 30)
```

```
## # A tibble: 30 x 6
##    country                continent  year lifeExp       pop gdpPercap
##    &lt;fct&gt;                  &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;     &lt;int&gt;     &lt;dbl&gt;
##  1 Indonesia              Asia       1952    37.5  82052000      750.
##  2 Malaysia               Asia       1982    68    14441916     4920.
##  3 Hong Kong, China       Asia       1967    70     3722800     6198.
##  4 Chile                  Americas   1977    67.1  10599793     4757.
##  5 Trinidad and Tobago    Americas   1997    69.5   1138101     8793.
##  6 Bosnia and Herzegovina Europe     1952    53.8   2791000      974.
##  7 Croatia                Europe     1952    61.2   3882229     3119.
##  8 Jordan                 Asia       2002    71.3   5307470     3845.
##  9 Nigeria                Africa     1997    47.5 106207839     1625.
## 10 Kenya                  Africa     2007    54.1  35610177     1463.
## # ... with 20 more rows
```
---
## Possible Solution: code Q2; Plot the data;

```r
ggplot(gapminder, aes(x = gdpPercap, y = lifeExp)) +
    geom_point(alpha = 0.2, shape = 21, fill = "blue", colour="black", size = 5) +
  geom_smooth(method = "lm", se = F, col = "maroon3") +
  geom_smooth(method = "loess", se = F, col = "limegreen") 
```

&lt;img src="DSRWay_files/figure-html/unnamed-chunk-38-1.png" style="display: block; margin: auto;" /&gt;
---
## Possible Solution: code Q3; simple regression model

```r
my.model &lt;- lm(gapminder_pipe$lifeExp ~ gapminder_pipe$gdpPercap)
summary(my.model)
```

```
## 
## Call:
## lm(formula = gapminder_pipe$lifeExp ~ gapminder_pipe$gdpPercap)
## 
## Residuals:
##      Min       1Q   Median       3Q      Max 
## -2.79839 -1.30472  0.00807  1.33443  2.87766 
## 
## Coefficients:
##                           Estimate Std. Error t value Pr(&gt;|t|)    
## (Intercept)              7.227e+01  6.942e-01 104.113  &lt; 2e-16 ***
## gapminder_pipe$gdpPercap 2.146e-04  2.514e-05   8.537  2.8e-09 ***
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 1.598 on 28 degrees of freedom
## Multiple R-squared:  0.7225,	Adjusted R-squared:  0.7125 
## F-statistic: 72.88 on 1 and 28 DF,  p-value: 2.795e-09
```
---
## Adding layers to your &lt;span style="color:blue"&gt;`ggplot()`&lt;/span&gt;


```r
ggplot(gapminder, aes(x = gdpPercap, y = lifeExp, col = "red")) +
      geom_point(alpha = 0.2, shape = 21, fill = "blue", colour="black", size = 5) +
  geom_smooth(method = "lm", se = F, col = "maroon3") +
  geom_smooth(method = "loess", se = F, col = "limegreen") +
  labs (title= "Life Exp. vs. Population Size", 
        x = "population", y = "Life Exp.") +
  theme(legend.position = "none", 
        panel.border = element_rect(fill = NA, 
                                    colour = "black",
                                    size = .75),
        plot.title=element_text(hjust=0.5)) +
  geom_text(x = 80000, y = 125, label = "regression line", col = "maroon3") +
  geom_text(x = 90000, y = 75, label = "smooth line", col = "limegreen")
```
---
## Voila
&lt;img src="DSRWay_files/figure-html/unnamed-chunk-41-1.png" style="display: block; margin: auto;" /&gt;
---
## **There is a challenge:** 

- `dplyr`'s `group_by()` function enables you to group your data. It allows you to create a separate df that splits the original df by a variable.

- `boxplot()` function produces boxplot(s) of the given (grouped) values.

Knowing about `group_by()` and `boxplot()` function, coud you compute the median life expectancy for year 2007 by continent and visualise your result?
---
## Possible Solution: 

Let us look at the median life expectancy for each continent

```r
gapminder %&gt;%
    group_by(continent) %&gt;%
    summarise(lifeExp = median(lifeExp))
```

```
## # A tibble: 5 x 2
##   continent lifeExp
##   &lt;fct&gt;       &lt;dbl&gt;
## 1 Africa       47.8
## 2 Americas     67.0
## 3 Asia         61.8
## 4 Europe       72.2
## 5 Oceania      73.7
```


**We are lucky that we live in Serbia, ie. Europe!!!**
---
## Possible Solution: 

```r
# visualise the information code
library("ggplot2")
ggplot(gapminder, aes(x = continent, y = lifeExp)) +
  geom_boxplot(outlier.colour = "hotpink") +
  geom_jitter(position = position_jitter(width = 0.1, height = 0), alpha = .2) +
  labs (title= "Life Exp. vs. Continent", 
        x = "Continent", y = "Life Exp.") +
  theme(legend.position = "none", 
        panel.border = element_rect(fill = NA, 
                                    colour = "black",
                                    size = .75),
        plot.title=element_text(hjust=0.5))
```
---
## Possible Solution: graph
&lt;img src="DSRWay_files/figure-html/unnamed-chunk-44-1.png" style="display: block; margin: auto;" /&gt;
---
class: inverse, center, middle

##Let's do Elain's Dance!!! ðŸ˜ƒðŸŽµðŸŽ¶

&lt;img src="images/Elain_dance.gif" width="500px" /&gt;
---
## useful links: 

cheatsheets:

- [data-wrangling-cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/02/data-wrangling-cheatsheet.pdf)

- [ggplot2-cheatsheet](https://www.rstudio.com/wp-content/uploads/2015/03/ggplot2-cheatsheet.pdf)

websites:

- [tidyverse, visualization, and manipulation basics](https://www.rstudio.com/resources/webinars/tidyverse-visualization-and-manipulation-basics/)

- [ggplot part of tidy verse](http://ggplot2.tidyverse.org/index.html)

- [Introduction to R graphics with ggplot2](http://tutorials.iq.harvard.edu/R/Rgraphics/Rgraphics.html#introduction)
---

class: center, middle

# Thanks!

[tanjakec.github.io](tanjakec.github.io)

@RLadiesBelgrade

@JovanaSavic2

@tikiblagojev

@KaticaR1

@Tatjana_Kec


Slides created via the R package [**xaringan**](https://github.com/yihui/xaringan).

The chakra comes from [remark.js](https://remarkjs.com), [**knitr**](http://yihui.name/knitr), and [R Markdown](https://rmarkdown.rstudio.com).
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "atelier-lakeside-light",
"highlightLines": true,
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
